(window.webpackJsonp=window.webpackJsonp||[]).push([["mui-cputils"],{332:function(e,t,r){var i,o;i=[r(0),r(2),r(1),r(3),r(5),r(7),r(11),r(6),r(13),r(24),r(12),r(8)],void 0===(o=function(e,t,r,i,o,s,n,a,c,u,l,p){"use strict";var h=new n({color:"orange",name:"publisher"});return r.Model.extend({_defaultCategories:{dflt:[{id:"business",name:p.getString("share-cp-category-business")},{id:"causes",name:p.getString("share-cp-category-causes")},{id:"education",name:p.getString("share-cp-category-education")},{id:"events",name:p.getString("share-cp-category-events")},{id:"food",name:p.getString("share-cp-category-food")},{id:"how_to",name:p.getString("share-cp-category-howto")},{id:"lifestyle",name:p.getString("share-cp-category-lifestyle")},{id:"photography",name:p.getString("share-cp-category-photography")},{id:"sports",name:p.getString("share-cp-category-sports")},{id:"stories",name:p.getString("share-cp-category-stories")},{id:"travel",name:p.getString("share-cp-category-travel")},{id:"other",name:p.getString("share-cp-category-other")}]},initialize:function(e){this._pubController=e.pubController,this.cpService=a.cps,this.apiKey=a.cpkey,this.publishedContentBases=a.publishedContentBases,this._htCC={},this.confirmView=l,s.featuresLoaded().then(function(){s.hasFeature("use-published-content-base-override")&&"object"==typeof a.publishedContentBasesOverride&&t.assign(this.publishedContentBases,a.publishedContentBasesOverride)}.bind(this))},checkPublishState:function(e){return this._pubController.checkPublishState(e)},checkUnpublishedState:function(e,t){return this._pubController.checkUnpublishedState(e,t)},remixDoc:function(e,t,r){var o=i.defer(),s=u.getAppByType(e),n=s.registeredName?s.registeredName:e;return s.load().then(function(){var i=s.getStorageImpl();"function"==typeof i.doRemix?i.doRemix(e,t,r).then(function(e){o.resolve(e)}.bind(this),function(e){o.reject(e)}):o.reject("app "+n+" does not support remix")},function(){o.reject("app "+n+" failed to load")}),o.promise},_verifyAssetId:function(e){var t=e.mrvlDoc,r=t.getMyApp(),o=!t.IS_REF&&"ginger-snap"===r.registeredName,s=!t.IS_REF&&r.isDocPublished(t);if(o)return s?i(r.getCPAlias(t)||r.getCPAssetId(t)):i();var n=!t.IS_REF&&r.getCPProjectId(t);return!n&&(n=r.generateCPProjectId(t)),this.checkPublishState(n).then(function(e,t,r){var i=e.id;return 0===i.indexOf("US/")&&(i=i.substr(3)),i},function(e,t,r){return 404!==e.status&&h.error("non-404 error checking publish state:"+r,e),e})},_defaultUnpublishCompositeDoc:function(e){var t=e.mrvlDoc,r=t.getMyApp(),s=i.defer();return this._verifyAssetId(e).then(function(i){if(i){var n=r.getCPCommunity(),a="https://"+this.cpService+"/api/v2/"+n+"/assets/"+i;o.ajax({type:"DELETE",url:a,headers:{Accept:"*/*","X-Api-Key":this.apiKey},success:function(i){e.isDelete?s.resolve(i):r.resetDocPublishData(t,s)}.bind(this),error:function(i){if(i&&404===i.status)e.isDelete?s.resolve():r.resetDocPublishData(t,s);else{var o="Unpublish error: "+i.status;h.error(o,i),s.reject({reason:o,xhr:i})}}.bind(this)})}else e.isDelete?s.resolve():r.resetDocPublishData(t,s)}.bind(this),function(e){if(404!==e.status){var t="Non-404 verify asset error in unpublish: "+e.status;h.error(t,e),s.reject({reason:t,xhr:e})}else s.resolve()}),s.promise},unpublishCompositeDoc:function(e){var t=e.mrvlDoc,r=i.defer(),o=t.getMyApp(),s=t.get("syncGroupName");return e.isDelete?r.resolve():c.syncGroups[s].getComposite(t.get("id"),null,!0).then(function(){r.resolve()},function(e){return h.error("publisher failed to unpublish, dcx pull failed",e),i.reject(e)}),r.promise.then(function(){return o.load().then(function(){var r=o.getPublishImpl();return r&&r.unpublishCompositeDocIfNeeded?r.unpublishCompositeDocIfNeeded(e).then(function(e){return e},function(e){return h.error("Unpublish error in implementation!",{error:e,doc:t}),i.reject(e)}):this._defaultUnpublishCompositeDoc(e)}.bind(this))}.bind(this))},appNameFromCommunity:function(e){if(!this.communityToApp){var r={};t.each(u.apps,function(e){r[e.getConfig().community]=e.getAppTypeID()}),this.communityToApp=r}return this.communityToApp[e]},cpLink:function(e,t,r){var i=this.appNameFromCommunity(e),o=this.publishedContentBases[i];return r||(h.warn("cpLink called with no cpAlias",{community:e,cpAssetId:t}),r=t),o+"/"+r+"/"},getHardCodedCommunityCategories:function(e,t){return this._defaultCategories?this._defaultCategories[e]?this._defaultCategories[e]:this._defaultCategories.dflt:null},getCommunityCategories:function(e,t){if(!this._htCC[e]){var r=i.defer(),s=this.getHardCodedCommunityCategories(e,t);this._htCC[e]=r,s?r.resolve(s):o.ajax({type:"GET",url:"https://"+this.cpService+"/api/v2/"+e+"/categories",headers:{Accept:"application/hal+json","X-Api-Key":this.apiKey},success:function(e){var i,o,s=[];if(e&&e._embedded&&e._embedded.categories){for(o=0;o<e._embedded.categories.length;o++)if(e._embedded.categories[o].id===t){i=e._embedded.categories[o];break}i&&(s=i.sub_categories)}r.resolve(s)},error:function(e){r.reject(e)}})}return this._htCC[e].promise},getCompositeItemsFromPubJsonRoot:function(e){var r={},i=0;return t.each(e.pages[0].sections,function(e){t.each(e.content_items,function(e){var t=e.image;t&&(t.id=c.AdobeDCXUtil.generateUuid(),r[t.id]=t,i++)}.bind(this))}.bind(this)),i?r:null},getPublishedJsonPiece:function(t,r){var o=i.defer(),s={src_url:t,json_id:r};return e.ajax({method:"POST",headers:{Accept:"application/hal+json"},url:"/ceepload/cpComp",dataType:"json",data:s,success:function(e,t,r){return 200!=r.status?o.reject(new Error("cpload cp came back with "+r.status+" "+r.responseText)):o.resolve(e)},error:function(e){return o.reject(e)}}),o.promise},_cpAssetsCopySizeRegexp:/&size=[0-9]{0,5}/,dupeCpAssets:function(e,r,o,s){s=s||{};var n,a=this.getCompositeItemsFromPubJsonRoot(r.lucajson),c=[],u=s.progressEvents||{},l="";return s.maxImageSize&&(l="&size="+s.maxImageSize),h.debug("dupeCpAssets, images:",a),a?(r.sourceImages=a,n=t.find(r.newDoc.getDCXComposite().current.getChildrenOf(),function(e){return"page"==e.name}),t.each(a,function(e,t){u.add&&marvel.events.trigger(u.add,1);var i=e.image_url.replace(this._cpAssetsCopySizeRegexp,l),s={copyFrom:{source:"cp",assetId:r.sourceRootURL+i},name:"Image",relationship:"image",path:o+t,parent:n,type:e.type,isUpdate:!1},a=r.newDoc.pushComponent(s);a.then(function(){u.resolved&&marvel.events.trigger(u.resolved,1)}),c.push(a)}.bind(this)),i.all(c)):i.resolve()},_generateIpsum:function(e){var t=[["Bike Move","Thundercats cillum High Life","Occupy organic narwhal squid"],["Echo Park quinoa next level leggings","Pitchfork 8-bit, tilde forage scenester chambray sustainable"],["Blog meggings Odd Future, Kickstarter pickled lo-fi Truffaut church-key bicycle rights"],["Kitsch heirloom umami typewriter farm-to-table deep v. Mlkshk single-origin coffee cold-pressed, yr try-hard heirloom master cleanse chillwave flannel pork belly. Listicle bespoke scenester Portland Kickstarter readymade. Four loko Brooklyn drinking vinegar blog, cardigan Etsy gastropub trust fund. Marfa mixtape migas deep v ugh chillwave. Forage heirloom vinyl synth mumblecore. Lo-fi locavore wayfarers, photo booth mixtape chia Bushwick synth master cleanse asymmetrical fashion axe Truffaut farm-to-table literally Etsy.","Sed chia Helvetica put a bird on it asymmetrical butcher. Deep v master cleanse aliquip, vegan excepteur reprehenderit kale chips actually wayfarers brunch sriracha wolf ethical flannel. Vinyl Schlitz church-key ea, fugiat Blue Bottle cornhole incididunt accusamus banh mi beard Odd Future. Food truck excepteur Schlitz blog mlkshk. Retro lo-fi distillery odio pug. Neutra exercitation master cleanse, single-origin coffee aliqua et Thundercats post-ironic. Trust fund mlkshk skateboard, wayfarers banjo gentrify yr McSweeney's exercitation."]],r=Math.floor(100*Math.random());return e.length<.8*t[1][0].length?t[0][r%t[0].length]:e.length<.8*t[2][0].length?t[1][r%t[1].length]:e.length<.8*t[3][0].length?t[2][r%t[2].length]:t[3][r%t[3].length]},createDuplicateFromCpModel:function(e,t){return this.createDuplicateFromCpInfo(e.get("type"),e.get("shareURL"),{progressEvents:t})},showDuplicateError:function(e,t,r,o){return e=e?"There has been an error trying to create the new project from the template: "+e+".":"We are sorry, but the project could not be created.",r&&h.error(r,o||t),this.confirmView.showAlert("Error creating from template",e).then(function(){return i.reject(t)})},createDuplicateFromCp:function(e){if(e.fromRoute&&!s.hasFeature("enable-tmpl-route"))return i.reject("not-enabled");var t=u.getAppByType(e.assetType);if(t){var r,o=i.defer();return r=s.hasFeature("create-from-template-use-dev")?"dev.adobeprojectm.com":"spark.adobe.com",window.marvel.events.trigger("show-interstitial",{typeName:e.assetType}),this.createDuplicateFromCpInfo(e.assetType,"https://"+r+"/"+e.assetType+"/"+e.assetId+"/",e).then(function(r){t.getStorageImpl().setSaveThumbOnLoad(),marvel.events.trigger("email-check"),marvel.navigate("design/"+t.typeName+"/"+r.get("id"),{trigger:!0}),r.triggerProjectCreatedAnalytics({contextData:{contextString:"template",exampleId:e.assetId}}),window.marvel.events.trigger("hide-interstitial",{typeName:e.assetType}),o.resolve()}.bind(this)).catch(function(e){o.reject(e)}.bind(this)),o.promise}return this.showDuplicateError("the source could not be found",{},"invalid asset type in handleTmpl",{url:window.location})},createDuplicateFromCpInfo:function(e,r,o){var n=u.getAppByType(e);if("page"!==e)return this.showDuplicateError("",new Error,"createDuplicateFromCpModel only supports type=page");i.defer();var a={};return a.sourceRootURL=r,"/"!==a.sourceRootURL.charAt(a.sourceRootURL.length-1)&&(a.sourceRootURL+="/"),this.getPublishedJsonPiece(a.sourceRootURL,"luca.json").then(function(r){return h.debug("got luca JSON",r),a.lucajson=r,n.load().then(function(){var i=n.getStorageImpl();return i.createDocument({assetType:e}).then(function(e){return a.newDoc=e,r.pages[0].author&&delete r.pages[0].author,s.hasFeature("create-from-ipsum")&&(r.title=this._generateIpsum(r.title),t.each(r.pages[0].sections,function(e,r){t.each(e.content_items,function(e){e.text&&(e.text=this._generateIpsum(e.text))}.bind(this))}.bind(this))),i.setData&&i.setData({title:r.title,publishTitle:r.title}),this.dupeCpAssets(n,a,"images/",o).then(function(e){var t,r,i;if(e&&e.length)for(i=0;i<e.length;i++)if(t=e[i]._data,r=a.sourceImages[t.path.substring("images/".length)]){var o=r.image_url.match(this._cpAssetsCopySizeRegexp)||"",s=t.etag&&"&img_etag="+t.etag.replace(/\"/g,"")||"";r.image_url="images/"+r.id+"?asset_id="+t.id+s+o,r.id=t.id}else h.error("missing image match:",t);n.setProjectName(a.newDoc,a.lucajson.title);var c=a.newDoc.nextSave();return n.storageImpl.saveDocument(a.lucajson),c.then(function(){return a.newDoc},function(e){return this.showDuplicateError("",e,"failed to save duplicated doc")})}.bind(this),function(e){return this.showDuplicateError("",e,"failed to dupeCpAssets")})}.bind(this),function(t){return this.showDuplicateError("",t,"createFrom failed to createDocument "+e)})}.bind(this),function(t){return this.showDuplicateError("",t,"createFrom failed to load app "+e)})}.bind(this),function(e){return this.showDuplicateError("the template could not be found",e,"failed to get published lucaJSON")}.bind(this))}})}.apply(t,i))||(e.exports=o)}}]);
//# sourceMappingURL=mui-cputils-c9ec7050.js.map